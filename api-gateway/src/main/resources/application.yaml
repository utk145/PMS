spring:
  application:
    name: api-gateway   # Logical name of this service (useful for discovery, logs)

  cloud:
    gateway:
      routes:

        # ================================
        # Route 1: Patient Service APIs
        # ================================
        - id: patient-service-route   # Unique identifier for this route

          # Where the request is forwarded AFTER routing & filters
          # "patient-service" is the Docker container name
          # 4000 is the internal container port
          uri: http://patient-service:4000

          predicates:
            # Match ANY request starting with /api/patients/
            # If this does not match, the route is ignored
            - Path=/api/patients/**

          filters:
            # Rewrite the incoming path before forwarding it
            #
            # Incoming request:
            #   /api/patients/get-patients
            #
            # Regex explanation:
            #   (?<segment>.*)  â†’ capture everything after /api/patients/
            #
            # Forwarded request:
            #   /api/v1/patients/get-patients
            #
            # NOTE:
            # - Works for ALL HTTP methods (GET, POST, PUT, DELETE)
            # - Body, headers, query params remain unchanged
            - RewritePath=/api/patients/(?<segment>.*),/api/v1/patients/${segment}

            # StripPrefix is NOT used because RewritePath already handles path mapping
            # - StripPrefix=1

        # ==================================
        # Route 2: Swagger / OpenAPI Docs
        # ==================================
        - id: api-docs-patient-route   # Unique route ID for API docs

          # Same backend service
          uri: http://patient-service:4000

          predicates:
            # Match ONLY this exact path
            - Path=/api-docs/patients

          filters:
            # Expose service Swagger docs through the gateway
            #
            # Incoming:
            #   /api-docs/patients
            #
            # Forwarded:
            #   /v3/api-docs
            #
            # Allows a single gateway URL for all service docs
            - RewritePath=/api-docs/patients,/v3/api-docs

server:
  port: 4004   # Gateway entry point (clients talk ONLY to this port)
